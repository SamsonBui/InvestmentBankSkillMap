<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Skills Matrix | Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            overflow: hidden;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        }

        .node-label {
            pointer-events: none;
            font-family: 'Inter', sans-serif;
            text-shadow: 
                2px 0 #fff, -2px 0 #fff, 0 2px #fff, 0 -2px #fff,
                1px 1px #fff, -1px -1px #fff, 1px -1px #fff, -1px 1px #fff;
            font-weight: 600;
        }

        /* Scrollbar for panel */
        #panel-scroll::-webkit-scrollbar {
            width: 6px;
        }
        #panel-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        #panel-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }

        /* Rating Bars */
        .rating-dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            background-color: #e2e8f0;
            transition: all 0.3s ease;
        }
        .rating-dot.active {
            opacity: 1;
        }
        
        /* Table Styles */
        .matrix-cell {
            transition: all 0.2s ease;
        }
        .matrix-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* Transition for panel content */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toggle Button Active State */
        .view-btn.active {
            background-color: #ffffff;
            color: #4f46e5;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .view-btn {
            color: #64748b;
        }
        .view-btn:hover:not(.active) {
            color: #334155;
        }

        /* Description Lists */
        .desc-list li {
            position: relative;
            padding-left: 1rem;
            margin-bottom: 0.25rem;
        }
        .desc-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #cbd5e1;
        }

    </style>
</head>
<body class="text-slate-800 h-screen w-screen flex flex-col relative bg-slate-50">

    <!-- Header -->
    <header class="absolute top-0 left-0 w-full p-6 z-20 pointer-events-none flex justify-between items-start">
        <div class="glass-panel pointer-events-auto inline-block px-8 py-5 rounded-2xl border-l-4 border-indigo-600">
            <h1 class="text-2xl font-bold text-slate-900 tracking-tight">Investment Bank Divisions & Skill Map</h1>
            <p class="text-sm text-slate-500 mt-1">Detailed Overlap Insights - SAMSON BUI</p>
        </div>

        <!-- View Toggle (Top Right) -->
        <div class="pointer-events-auto bg-slate-200/50 backdrop-blur-md rounded-lg p-1 border border-white/60 shadow-sm flex gap-1">
            <button id="btn-network" class="view-btn active px-4 py-2 rounded-md text-sm font-semibold transition-all">Network</button>
            <button id="btn-matrix" class="view-btn px-4 py-2 rounded-md text-sm font-semibold transition-all">Matrix</button>
        </div>
    </header>

    <!-- Main Visualization: Network -->
    <div id="viz-container" class="w-full h-full absolute inset-0 transition-opacity duration-300 z-10" style="background: radial-gradient(circle at center, #ffffff 0%, #f1f5f9 100%);"></div>

    <!-- Main Visualization: Matrix Table (Hidden by default) -->
    <div id="matrix-container" class="w-full h-full absolute inset-0 opacity-0 pointer-events-none transition-opacity duration-300 z-10 flex items-center justify-center p-12 pt-32 bg-slate-50">
        <div class="w-full h-full max-w-6xl overflow-auto glass-panel rounded-2xl shadow-xl p-6" id="matrix-scroll">
            <table class="w-full border-collapse">
                <thead>
                    <tr id="matrix-header">
                        <!-- Headers injected via JS -->
                    </tr>
                </thead>
                <tbody id="matrix-body">
                    <!-- Rows injected via JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Right Sidebar (Detailed Info) -->
    <div id="info-panel" class="absolute top-6 right-6 bottom-6 w-96 glass-panel rounded-2xl flex flex-col transform translate-x-[120%] transition-transform duration-500 z-30 shadow-2xl border-white/50">
        
        <!-- Panel Header -->
        <div class="p-6 border-b border-slate-100 flex justify-between items-start shrink-0 bg-white/40">
            <div>
                <div id="panel-type" class="text-xs font-bold uppercase tracking-wider text-indigo-500 mb-1">Department</div>
                <h2 id="panel-title" class="text-2xl font-bold text-slate-900 leading-tight">IBD</h2>
            </div>
            <button id="close-panel" class="text-slate-400 hover:text-slate-700 transition-colors p-2 hover:bg-white rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Panel Content (Scrollable) -->
        <div id="panel-scroll" class="flex-1 overflow-y-auto p-6 space-y-6">
            <div id="panel-desc" class="text-slate-600 text-sm leading-relaxed border-l-4 border-indigo-200 pl-4 py-1">
                <!-- Row Profile goes here -->
            </div>
            
            <div class="border-t border-slate-100 pt-4">
                 <h4 class="text-xs font-bold uppercase tracking-wider text-slate-400 mb-4">Skill Breakdown</h4>
                 <div id="panel-details" class="space-y-4">
                    <!-- Skill items go here -->
                 </div>
            </div>
        </div>
    </div>

    <!-- Legend (Network only) -->
    <div id="network-legend" class="absolute bottom-6 left-6 z-20 pointer-events-none hidden md:block">
        <div class="glass-panel pointer-events-auto p-5 rounded-xl flex flex-col gap-3 max-w-[200px]">
            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Skill Colors</div>
            <div id="legend-items" class="space-y-2">
                <!-- Legend items injected by JS -->
            </div>
            <div class="h-px bg-slate-200 my-2"></div>
            <div class="text-xs text-slate-400 leading-tight">
                Scroll to Zoom.<br>Drag to Rearrange.
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & COLORS ---
        const categoryColors = {
            "Client / People Skills": "#f59e0b", // Amber
            "Math / Analytics": "#8b5cf6",       // Violet
            "Coding / Tech": "#10b981",          // Emerald
            "Project / Deal Work": "#ec4899",    // Pink
            "Risk / Control Mindset": "#ef4444", // Red
            "Process / Detail": "#64748b"        // Slate
        };

        // New distinct colors for the Matrix view columns
        const matrixColors = [
            "#3b82f6", // Blue
            "#8b5cf6", // Violet
            "#10b981", // Emerald
            "#f59e0b", // Amber
            "#ef4444", // Red
            "#64748b"  // Slate
        ];

        const deptColor = "#1e293b"; // Dark Slate for Depts

        const skillCategories = [
            { id: "Client / People Skills", short: "Client / People", color: categoryColors["Client / People Skills"] },
            { id: "Math / Analytics", short: "Math / Analytics", color: categoryColors["Math / Analytics"] },
            { id: "Coding / Tech", short: "Coding / Tech", color: categoryColors["Coding / Tech"] },
            { id: "Project / Deal Work", short: "Project / Deal", color: categoryColors["Project / Deal Work"] },
            { id: "Risk / Control Mindset", short: "Risk / Control", color: categoryColors["Risk / Control Mindset"] },
            { id: "Process / Detail", short: "Process / Detail", color: categoryColors["Process / Detail"] }
        ];

        // --- DATASET v3 (With Detailed Descriptions) ---
        const departmentsData = {
            "Investment Bank Division": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Investment bankers help companies do <strong>big one-time money moves</strong>: Buying another company, Selling themselves, Going public (IPO), or raising large chunks of capital.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Architects & Deal-Makers</span>
                            Imagine a company wants to build a giant bridge. IBD designs the plan (cost, value), creates the presentation to convince everyone, and coordinates the teams.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Build Excel models forecasting profits and value</li>
                                <li>Create PowerPoint decks explaining deals to CEOs</li>
                                <li>Sit on client calls answering "what if?" questions</li>
                                <li>Work late revising numbers when new info arrives</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            CEOs/CFOs, Lawyers, Accountants, Capital Markets, Risk, Ops.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 4, text: "Spend time on calls/meetings with CFOs/CEOs. Turning dense models into simple stories." },
                    "Math / Analytics": { score: 3, text: "Fluent with valuation, 3-statement models, sensitivity tables. Not advanced stats." },
                    "Coding / Tech": { score: 1, text: "Almost never drives the job. Excel, PowerPoint, Word. Maybe a few macros." },
                    "Project / Deal Work": { score: 5, text: "The heart of IBD. Long, messy projects, coordinating models, data rooms, diligence." },
                    "Risk / Control Mindset": { score: 3, text: "Understanding financing/reputational risk. Important but secondary to deal work." },
                    "Process / Detail": { score: 3, text: "Formatting, numbers, wording must be perfect. Mid-level skill." }
                }
            },
            "Sales": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Sales talks to big investors (hedge funds, asset managers) and helps them <strong>buy and sell financial products</strong> through the bank.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Friendly Shopkeepers</span>
                            Clients walk into the marketplace asking "What's interesting today?" Sales understands what they like, brings ideas from traders, and executes the order.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Call/Message clients about market moves & ideas</li>
                                <li>Work with traders to get the best price</li>
                                <li>Keep notes on client preferences and positions</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Funds, Asset Managers, Traders, Structuring, Research.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 5, text: "Lives on the phone/chat. Translating market moves into ideas. Being good with people dominates." },
                    "Math / Analytics": { score: 3, text: "Quick mental math for yields, spreads, P&L. Necessary but not defining." },
                    "Coding / Tech": { score: 1, text: "Mostly chat systems, pricing tools, CRMs. Not a build-role." },
                    "Project / Deal Work": { score: 2, text: "Constant flows rather than long projects." },
                    "Risk / Control Mindset": { score: 3, text: "Know your products, suitability, and when something smells off." },
                    "Process / Detail": { score: 3, text: "Accurate booking and confirmations matter for P&L." }
                }
            },
            "Trading": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Traders <strong>set prices and manage risk</strong> for the bank’s positions in stocks, bonds, currencies, and derivatives.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Market Stall Owners</span>
                            They constantly change prices based on supply and demand, standing ready to buy or sell at any moment.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Watch screens of prices and news constantly</li>
                                <li>Quote bid/ask prices to sales</li>
                                <li>Take positions and hedge them to control risk</li>
                                <li>Monitor P&L and risk limits</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Sales, Structuring, Risk Management, Quants, Tech.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 3, text: "Short, direct bursts focused on price, size, risk. Markets-first." },
                    "Math / Analytics": { score: 4, text: "Probability, distributions, scenario thinking. Analytical heavy." },
                    "Coding / Tech": { score: 3, text: "Scripting small tools in Python, tweaking spreadsheets." },
                    "Project / Deal Work": { score: 2, text: "Intraday and continuous. Not long project cycles." },
                    "Risk / Control Mindset": { score: 5, text: "Taking risk in a controlled way. The core responsibility." },
                    "Process / Detail": { score: 3, text: "Precise trade entry and end-of-day checks prevent nightmares." }
                }
            },
            "Structuring": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Structurers build <strong>custom financial products</strong> to match what a client wants (e.g., "I want income, but protection if the market falls").
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Engineers of Custom Combos</span>
                            Designing a specific basket of goods (options, bonds, swaps) so the client gets exactly the payoff they need.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Talk with sales/traders to understand client needs</li>
                                <li>Design products using financial building blocks</li>
                                <li>Model and price products, testing scenarios</li>
                                <li>Write term sheets describing payoffs</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Sales & Trading, Quants, Risk, Legal, Ops.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 3, text: "Technical explainers rather than pure relationship owners." },
                    "Math / Analytics": { score: 4, text: "Designing exotic products requires probabilities and payoffs." },
                    "Coding / Tech": { score: 3, text: "Prototyping in Python, running scenarios, pricing libraries." },
                    "Project / Deal Work": { score: 3, text: "Each new structure is a mini-project with constraints." },
                    "Risk / Control Mindset": { score: 4, text: "Thinking about downside and regulatory constraints." },
                    "Process / Detail": { score: 3, text: "Spec-checking payoffs and legal language matters." }
                }
            },
            "Research": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Research analysts study companies, sectors, or the economy and publish <strong>reports and opinions</strong> on what might happen next.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Library + Weather Station</span>
                            Deep knowledge on companies (Library) + forecasts of economic storms or booms (Weather Station).
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Read financial statements, news, and reports</li>
                                <li>Build earnings models and forecasts</li>
                                <li>Write research notes explaining undervalued stocks</li>
                                <li>Talk with clients to explain views</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            External Clients, Sales & Trading, IBD, Asset Mgmt.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 4, text: "Constantly explaining views to sales, traders, and clients." },
                    "Math / Analytics": { score: 4, text: "Building earnings/macro models, digging through data." },
                    "Coding / Tech": { score: 2, text: "Some Python/R, but many rely on spreadsheets." },
                    "Project / Deal Work": { score: 3, text: "Coverage and thematic reports are longish projects." },
                    "Risk / Control Mindset": { score: 3, text: "Understanding downside scenarios to thesis." },
                    "Process / Detail": { score: 3, text: "Data sources and charts must be accurate." }
                }
            },
            "Asset / Wealth Mgmt": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            These teams <strong>manage money for others</strong> over the long term—pension funds, mutual funds, or wealthy individuals.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Professional Gardeners</span>
                            Clients give them "seeds" (money). They decide what to plant, water, and prune over years so the garden grows without dying in storms.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Decide allocations (stocks, bonds, cash)</li>
                                <li>Monitor performance vs benchmarks</li>
                                <li>Adjust portfolios when markets change</li>
                                <li>Meet clients to explain what's happening</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Clients (pensions, individuals), Research, Markets, Risk.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 4, text: "Explaining portfolio decisions, managing emotions, building trust." },
                    "Math / Analytics": { score: 3, text: "Expected returns, volatility, correlation at portfolio level." },
                    "Coding / Tech": { score: 2, text: "Some Python for backtests, but mostly platforms." },
                    "Project / Deal Work": { score: 3, text: "Strategy launches and major reallocations." },
                    "Risk / Control Mindset": { score: 4, text: "Drawdowns, risk budgets, emotional handling of client paths." },
                    "Process / Detail": { score: 3, text: "Rebalancing rules and reporting standards." }
                }
            },
            "Corporate Banking": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Corporate bankers provide <strong>loans and everyday banking services</strong> to big companies (credit lines, cash management).
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: The Main Branch for Big Biz</span>
                            Like a checking account + loans department, but for giant corporations.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Meet corporate clients to understand funding needs</li>
                                <li>Analyze financial health and credit risk</li>
                                <li>Propose loan structures and covenants</li>
                                <li>Coordinate with Risk/IBD on financing</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Corporate Clients (Treasurers), Risk, Ops, IBD.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 4, text: "Long-term relationships with treasurers/CFOs." },
                    "Math / Analytics": { score: 3, text: "Credit analysis: leverage, coverage ratios, loan pricing." },
                    "Coding / Tech": { score: 1, text: "Credit systems and Excel. Almost purely finance/relationship." },
                    "Project / Deal Work": { score: 3, text: "Facilities and amendments are mini-deals." },
                    "Risk / Control Mindset": { score: 4, text: "Default risk, collateral, covenants. Very credit-sensitive." },
                    "Process / Detail": { score: 3, text: "Loan docs and approval workflows require detail." }
                }
            },
            "Prime Brokerage": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Prime Brokerage gives <strong>hedge funds</strong> the tools to trade: leverage (borrowing), stock to short, and operational support.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Landlord + Tool Rental</span>
                            They rent out the "tools" (stock/money), provide the "workshop" (infrastructure), and manage the "security deposit" (margin).
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Track positions, margin, and financing costs</li>
                                <li>Arrange stock lending for short-selling</li>
                                <li>Send reports on risk and P&L</li>
                                <li>Work with Risk on margin calls</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Hedge Funds, Trading, Risk, Ops, Tech, Treasury.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 4, text: "Dealing with hedge funds/ops staff under pressure." },
                    "Math / Analytics": { score: 3, text: "Financing rates, margin calcs, portfolio exposures." },
                    "Coding / Tech": { score: 2, text: "Some scripting for margins, but mostly existing systems." },
                    "Project / Deal Work": { score: 2, text: "Continuous service beats long projects here." },
                    "Risk / Control Mindset": { score: 4, text: "Watching client leverage/concentration. Margin calls." },
                    "Process / Detail": { score: 4, text: "Collateral and settlements must be clean and timely." }
                }
            },
            "Risk Management": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Risk managers make sure the bank <strong>doesn't blow itself up</strong>. They watch risk levels and set rules/limits.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Fire Inspectors</span>
                            They check buildings are up to code (limits), run fire drills (stress tests), and say "no" when things are dangerous.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Monitor risk reports and potential losses</li>
                                <li>Approve or reject big trades/products</li>
                                <li>Run stress scenarios (e.g., "What if rates jump?")</li>
                                <li>Write policies and limits</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Trading, Structuring, Corp Bank, Prime, Treasury.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 3, text: "Saying 'no' to internal desks without blowing up relationships." },
                    "Math / Analytics": { score: 4, text: "VaR, sensitivities, stress tests. Quantitatively grounded." },
                    "Coding / Tech": { score: 2, text: "SQL/Python for deep dives, but canned reporting covers a lot." },
                    "Project / Deal Work": { score: 2, text: "Recurring monitoring/approvals rather than long deals." },
                    "Risk / Control Mindset": { score: 5, text: "The core identity. Asking 'what if this goes wrong?'." },
                    "Process / Detail": { score: 4, text: "Regulators/auditors live in your docs. Precision is key." }
                }
            },
            "Operations": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Operations makes sure that all the <strong>promises the bank makes actually happen</strong>—money moves, trades settle, records match.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Postal Service & Plumbers</span>
                            Making sure every "package" (trade) arrives, and keeping the pipes (payments/records) from leaking.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Ensure trades are booked correctly</li>
                                <li>Match bank records with exchanges</li>
                                <li>Fix breaks where numbers don't match</li>
                                <li>Handle cash movements and confirmations</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Front-office (Trading/Sales/IBD), Prime, Clients, Tech.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 3, text: "Solving practical issues with internal desks/counterparties." },
                    "Math / Analytics": { score: 2, text: "Reconciliations, cash balances. Simple checks." },
                    "Coding / Tech": { score: 2, text: "Some automation, but mostly vendor systems." },
                    "Project / Deal Work": { score: 2, text: "Repetitive but critical daily processing." },
                    "Risk / Control Mindset": { score: 4, text: "Last line of defense on ops risk, breaks, mismatches." },
                    "Process / Detail": { score: 5, text: "Following procedures and spotting tiny inconsistencies." }
                }
            },
            "Technology": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Technology teams build and maintain the <strong>software and systems</strong> everyone else uses: trading platforms, risk dashboards, data pipelines.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Electricians & Engineers</span>
                            Keeping the lights on (systems running), building new roads (platforms), and fixing outages.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Write code (Python, Java, C++, JS)</li>
                                <li>Build trading systems and data feeds</li>
                                <li>Understand desk requirements</li>
                                <li>Handle incidents and bugs</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Almost everyone: Traders, Quants, Risk, Ops, IBD.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 3, text: "Gathering requirements, managing expectations." },
                    "Math / Analytics": { score: 3, text: "Logical thinking, system metrics. Quant awareness." },
                    "Coding / Tech": { score: 5, text: "The core craft: designing/maintaining systems." },
                    "Project / Deal Work": { score: 2, text: "Sprints/releases are structured, but not 'deals'." },
                    "Risk / Control Mindset": { score: 3, text: "Respect for testing, rollbacks, and security." },
                    "Process / Detail": { score: 4, text: "Version control, code reviews, documentation." }
                }
            },
            "Quants": {
                desc: `
                    <div class="space-y-4">
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Plain English</span>
                            Quants use <strong>math + code</strong> to build models for pricing, trading, and risk. Turning financial problems into algorithms.
                        </div>
                        <div>
                            <span class="font-bold text-indigo-600 block mb-1">Analogy: Math Lab on the Trading Floor</span>
                            Inventing "formulas" for value, building calculators traders use, and measuring danger.
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Day-to-Day</span>
                            <ul class="desc-list">
                                <li>Develop pricing models for complex products</li>
                                <li>Write code (Python/C++) to implement models</li>
                                <li>Backtest strategies on historical data</li>
                                <li>Work with traders to calibrate models</li>
                            </ul>
                        </div>
                        <div>
                            <span class="font-bold text-slate-700 block mb-1">Works With</span>
                            Trading, Structuring, Risk, Tech.
                        </div>
                    </div>`,
                skills: {
                    "Client / People Skills": { score: 2, text: "Technical communication. Not relationship-driven." },
                    "Math / Analytics": { score: 5, text: "The core: pricing models, risk engines, advanced stats." },
                    "Coding / Tech": { score: 4, text: "Implementing models in Python/C++." },
                    "Project / Deal Work": { score: 1, text: "Technical projects (models), not client deals." },
                    "Risk / Control Mindset": { score: 4, text: "Understanding model failure in stress." },
                    "Process / Detail": { score: 3, text: "Calibration procedures and documentation." }
                }
            }
        };

        // --- POPULATE LEGEND (NETWORK) ---
        const legendContainer = document.getElementById('legend-items');
        skillCategories.forEach(cat => {
            const row = document.createElement('div');
            row.className = "flex items-center gap-2";
            row.innerHTML = `
                <span class="w-3 h-3 rounded-full" style="background-color: ${cat.color};"></span>
                <span class="text-[10px] font-medium text-slate-600 truncate">${cat.short}</span>
            `;
            legendContainer.appendChild(row);
        });

        // ============================================
        // MATRIX VIEW LOGIC
        // ============================================
        
        const matrixHeader = document.getElementById('matrix-header');
        const matrixBody = document.getElementById('matrix-body');

        function renderMatrix() {
            // 1. Headers (Empty corner + Skills)
            let headerHTML = `<th class="p-3 text-left text-xs font-bold uppercase tracking-wider text-slate-400 sticky left-0 bg-slate-50 z-20">Department</th>`;
            skillCategories.forEach((skill, index) => {
                // Use the new matrixColors array based on index
                const color = matrixColors[index % matrixColors.length];
                headerHTML += `<th class="p-3 text-center text-xs font-bold uppercase tracking-wider text-slate-500" style="color:${color}">${skill.short}</th>`;
            });
            matrixHeader.innerHTML = headerHTML;

            // 2. Rows (Departments)
            let bodyHTML = '';
            Object.entries(departmentsData).forEach(([deptName, data]) => {
                let rowCells = `<td class="p-3 text-sm font-bold text-slate-700 sticky left-0 bg-slate-50 border-r border-slate-100 z-10 hover:text-indigo-600 cursor-pointer" onclick="openPanelByName('${deptName}')">${deptName}</td>`;
                
                skillCategories.forEach((skill, index) => {
                    const skillInfo = data.skills[skill.id];
                    const score = skillInfo ? skillInfo.score : 0;
                    
                    // Heatmap logic: Opacity based on score (1=0.2, 5=1.0)
                    const opacity = score / 5;
                    // For text color: White if dark bg, else text-slate-800. If opacity < 0.5 use dark text.
                    const textColor = score >= 3 ? 'white' : 'rgba(0,0,0,0.6)';

                    // Use the new matrixColors array based on index
                    const color = matrixColors[index % matrixColors.length];
                    
                    rowCells += `
                        <td class="p-1">
                            <div class="matrix-cell w-full h-12 rounded-lg flex items-center justify-center font-bold text-lg cursor-pointer" 
                                 style="background-color: ${color}; opacity: ${score === 0 ? 0.05 : opacity}; color: ${textColor}"
                                 title="${deptName} - ${skill.short}: ${score}/5"
                                 onclick="openPanelByName('${deptName}')">
                                ${score > 0 ? score : '-'}
                            </div>
                        </td>
                    `;
                });
                bodyHTML += `<tr>${rowCells}</tr>`;
            });
            matrixBody.innerHTML = bodyHTML;
        }

        renderMatrix(); // Init matrix

        // ============================================
        // VIEW SWITCHING LOGIC
        // ============================================

        const btnNetwork = document.getElementById('btn-network');
        const btnMatrix = document.getElementById('btn-matrix');
        const vizContainer = document.getElementById('viz-container');
        const matrixContainer = document.getElementById('matrix-container');
        const networkLegend = document.getElementById('network-legend');

        btnNetwork.addEventListener('click', () => switchView('network'));
        btnMatrix.addEventListener('click', () => switchView('matrix'));

        function switchView(view) {
            if(view === 'network') {
                btnNetwork.classList.add('active');
                btnMatrix.classList.remove('active');
                
                vizContainer.classList.remove('opacity-0', 'pointer-events-none');
                matrixContainer.classList.add('opacity-0', 'pointer-events-none');
                networkLegend.classList.remove('hidden');
                
            } else {
                btnMatrix.classList.add('active');
                btnNetwork.classList.remove('active');

                vizContainer.classList.add('opacity-0', 'pointer-events-none');
                matrixContainer.classList.remove('opacity-0', 'pointer-events-none');
                networkLegend.classList.add('hidden');
            }
            closePanel(); // Close detail panel when switching views
        }

        function openPanelByName(deptName) {
            // Find the dept node in D3 data to reuse openPanel logic, 
            // OR just mock the node object since openPanel mostly needs ID and Color
            const node = nodes.find(n => n.id === deptName);
            if(node) openPanel(node);
        }

        // ============================================
        // NETWORK GRAPH (D3) LOGIC
        // ============================================

        const nodes = [];
        const links = [];

        // 1. Create Skill Nodes
        skillCategories.forEach(skill => {
            nodes.push({ 
                id: skill.id, 
                group: 'skill', 
                short: skill.short,
                color: skill.color
            });
        });

        // 2. Create Dept Nodes and Links
        Object.entries(departmentsData).forEach(([deptName, data]) => {
            nodes.push({ 
                id: deptName, 
                group: 'dept',
                color: deptColor 
            });
            
            Object.entries(data.skills).forEach(([skillName, skillData]) => {
                links.push({
                    source: deptName,
                    target: skillName,
                    score: skillData.score,
                    text: skillData.text
                });
            });
        });

        const width = vizContainer.clientWidth;
        const height = vizContainer.clientHeight;

        const svg = d3.select("#viz-container").append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", [0, 0, width, height]);

        const g = svg.append("g");

        const zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on("zoom", (e) => g.attr("transform", e.transform));
        svg.call(zoom);

        // Force Simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
                return 300 - (d.score * 10); 
            }))
            .force("charge", d3.forceManyBody().strength(-3000)) 
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collide", d3.forceCollide().radius(d => d.group === 'dept' ? 65 : 45).iterations(2));

        // Links
        const link = g.append("g")
            .attr("stroke", "#94a3b8") 
            .attr("stroke-opacity", 0.6) 
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("stroke-width", d => Math.max(1.5, d.score * 1.5)) 
            .attr("class", "transition-all duration-300");

        // Nodes Group
        const node = g.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("class", "cursor-pointer transition-opacity duration-300")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Node Circles
        node.append("circle")
            .attr("r", d => d.group === 'dept' ? 35 : 18)
            .attr("fill", d => d.group === 'dept' ? d.color : "#ffffff") 
            .attr("stroke", d => d.color)
            .attr("stroke-width", d => d.group === 'dept' ? 0 : 5)
            .attr("class", "shadow-lg drop-shadow-md");

        node.filter(d => d.group === 'dept')
            .append("circle")
            .attr("r", 32)
            .attr("fill", "none")
            .attr("stroke", "rgba(255,255,255,0.2)")
            .attr("stroke-width", 2);

        // Labels
        node.append("text")
            .attr("class", "node-label")
            .attr("dy", d => d.group === 'dept' ? 58 : 38)
            .attr("text-anchor", "middle")
            .attr("fill", "#1e293b")
            .attr("font-size", d => d.group === 'dept' ? "14px" : "12px")
            .style("font-weight", d => d.group === 'dept' ? "700" : "500")
            .text(d => d.group === 'dept' ? d.id : d.short);

        // --- INTERACTION ---

        const panel = document.getElementById('info-panel');
        const panelTitle = document.getElementById('panel-title');
        const panelType = document.getElementById('panel-type');
        const panelDesc = document.getElementById('panel-desc');
        const panelDetails = document.getElementById('panel-details');
        const closeBtn = document.getElementById('close-panel');

        node.on("click", (event, d) => {
            event.stopPropagation();
            
            // Dim everyone
            node.transition().duration(200).style("opacity", 0.15);
            link.transition().duration(200).style("stroke-opacity", 0.05).attr("stroke", "#cbd5e1");

            // Highlight Self
            d3.select(event.currentTarget).transition().duration(200).style("opacity", 1);
            
            // Highlight Neighbors
            const connectedLinks = links.filter(l => l.source.id === d.id || l.target.id === d.id);
            const connectedIds = new Set(connectedLinks.map(l => l.source.id === d.id ? l.target.id : l.source.id));
            
            node.filter(n => connectedIds.has(n.id))
                .transition().duration(200)
                .style("opacity", 1);
            
            link.filter(l => l.source.id === d.id || l.target.id === d.id)
                .transition().duration(200)
                .style("stroke-opacity", 0.8)
                .attr("stroke", l => {
                     const skillID = (l.source.group === 'skill') ? l.source.id : l.target.id;
                     const skillNode = nodes.find(n => n.id === skillID);
                     return skillNode ? skillNode.color : "#3b82f6";
                });

            openPanel(d);
        });

        svg.on("click", () => {
            closePanel();
            resetGraph();
        });

        closeBtn.addEventListener('click', () => {
            closePanel();
            resetGraph();
        });

        function resetGraph() {
            node.transition().duration(300).style("opacity", 1);
            link.transition().duration(300).style("stroke-opacity", 0.6).attr("stroke", "#94a3b8");
        }

        function openPanel(d) {
            panel.classList.remove('translate-x-[120%]');
            panelTitle.innerText = d.id;
            panelType.innerText = d.group === 'dept' ? "Department Profile" : "Skill Category";
            panelDetails.innerHTML = '';
            
            const accentColor = d.color;
            panelType.style.color = d.group === 'dept' ? '#4f46e5' : d.color; 

            if(d.group === 'dept') {
                const data = departmentsData[d.id];
                panelDesc.innerHTML = data.desc; // Use innerHTML directly for rich content
                
                const sortedSkills = Object.entries(data.skills).sort((a,b) => b[1].score - a[1].score);

                sortedSkills.forEach(([skillName, skillInfo]) => {
                    const skillNode = nodes.find(n => n.id === skillName);
                    const color = skillNode.color;

                    let dotsHtml = '';
                    for(let i=1; i<=5; i++) {
                        const isActive = i <= skillInfo.score;
                        const dotColor = isActive ? color : '#e2e8f0';
                        dotsHtml += `<div class="rating-dot" style="background-color: ${dotColor};"></div>`;
                    }

                    const item = document.createElement('div');
                    item.className = "fade-in bg-slate-50 p-4 rounded-xl border border-slate-100 shadow-sm";
                    item.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 rounded-full" style="background-color: ${color}"></div>
                                <h4 class="font-bold text-slate-700 text-sm">${skillNode.short}</h4>
                            </div>
                            <div class="flex gap-1">${dotsHtml}</div>
                        </div>
                        <p class="text-xs text-slate-500 leading-relaxed">${skillInfo.text}</p>
                    `;
                    panelDetails.appendChild(item);
                });

            } else {
                panelDesc.innerHTML = "<p class='text-slate-600 italic'>Select a Department node to see specific context and scoring for this skill.</p>";
                
                const highUsers = links.filter(l => l.target.id === d.id && l.score >= 4).map(l => l.source.id);
                
                if(highUsers.length > 0) {
                    const item = document.createElement('div');
                    item.innerHTML = `
                        <h4 class="text-xs font-bold uppercase text-slate-400 mb-3">Top Depts for this skill</h4>
                        <div class="flex flex-wrap gap-2">
                            ${highUsers.map(u => `<span class="px-3 py-1 bg-white border border-slate-200 text-slate-700 shadow-sm rounded-full text-xs font-semibold">${u}</span>`).join('')}
                        </div>
                    `;
                    panelDetails.appendChild(item);
                }
            }
        }

        function closePanel() {
            panel.classList.add('translate-x-[120%]');
        }

        // --- D3 BOILERPLATE ---
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

    </script>
</body>
</html>